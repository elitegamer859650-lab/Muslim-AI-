<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Islamic AI Assistant</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <script>
      tailwind.config = {
        darkMode: "class", // This enables dark mode (though the app doesn't have a toggle, the classes are there)
        theme: {
          extend: {
            fontFamily: {
              arabic: ['"Noto Naskh Arabic"', "serif"],
            },
          },
        },
      };
    </script>

    <script
      src="https://unpkg.com/react@18/umd/react.development.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
      crossorigin
    ></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://unpkg.com/lucide@latest"></script>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      // Get React functions from the global "React" object
      const { useState, useRef, useEffect } = React;

      // --- All your helper functions and data (unchanged) ---

      // Types (interfaces are fine, but types are simpler here)
      type Language = "en" | "ur" | "ar" | "hi" | "roman-ur" | "roman-hi";

      // Mock tafseer data
      const mockTafseerData = {
        "2:255": {
          reference: "Surah Al-Baqarah 2:255",
          arabic:
            "اللَّهُ لَا إِلَٰهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ ۝ لَا تَأْخُذُهُ سِنَةٌ وَلَا نَوْمٌ ۝ لَهُ مَا فِي السَّمَاوَاتِ وَمَا فِي الْأَرْضِ ۝ مَنْ ذَا الَّذِي يَشْفَعُ عِندَهُ إِلَّا بِإِذْنِهِ ۝ يَعْلَمُ مَا بَيْنَ أَيْدِيهِمْ وَمَا خَلْفَهُمْ ۝ وَلَا يُHِيطُونَ بِشَيْءٍ مِّنْ عِلْمِهِ إِلَّا بِمَا شَاءَ ۚ وَسِعَ كُرْسِيُّهُ السَّمَاوَاتِ وَالْأَرْضَ ۖ وَلَا يَئُودُهُ حِفْظُهُمَا ۚ وَهُوَ الْعَلِيُّ الْعَظِيمُ",
          translation:
            "Allah - there is none worthy of worship except Him, the Ever-Living, the Sustainer of existence. Neither drowsiness overtakes Him nor sleep. To Him belongs whatever is in the heavens and whatever is on the earth. Who is it that can intercede with Him except by His permission? He knows what is before them and what will be after them, and they encompass not a thing of His knowledge except for what He wills. His Kursi extends over the heavens and the earth, and their preservation tires Him not. And He is the Most High, the Supreme.",
          tafsir:
            "This verse, known as Ayat al-Kursi, is one of the most powerful verses in the Quran. It establishes Allah's absolute oneness, His eternal nature, and His complete knowledge and control over all creation. The verse emphasizes that Allah is free from all weaknesses like drowsiness and sleep. It also highlights that no one can intercede with Allah except by His permission, showing His absolute authority. The concept of Kursi (Throne) is explained as encompassing the heavens and the earth, indicating Allah's infinite power and knowledge. This verse is a comprehensive description of Allah's attributes and is considered a protection for those who recite it.",
        },
        "2:285": {
          reference: "Surah Al-Baqarah 2:285",
          arabic:
            "آمَنَ الرَّسُولُ بِمَا أُنزِلَ إِلَيْهِ مِن رَّبِّهِ وَالْمُؤْمِنُونَ ۚ كُلٌّ آمَنَ بِاللَّهِ وَمَلَائِكَتِهِ وَكُتُبِهِ وَرُسُلِهِ لَا نُفَرِّقُ بَيْنَ أَحَدٍ مِّن رُّسُلِهِ ۚ وَقَالُوا سَمِعْنَا وَأَطَعْنَا ۖ غُفْرَانَكَ رَبَّنَا وَإِلَيْكَ الْمَصِيرُ",
          translation:
            "The Messenger has believed in what was revealed to him from his Lord, and [so have] the believers. All of them have believed in Allah and His angels and His books and His messengers, [saying], 'We make no distinction between any of His messengers.' And they say, 'We hear and we obey. [We seek] Your forgiveness, our Lord, and to You is the [final] destination.'",
          tafsir:
            "This verse outlines the fundamental beliefs of a Muslim (Iman). It emphasizes that true believers must accept all prophets and messengers without discrimination. The verse also highlights the importance of complete submission to Allah's commands with the declaration 'We hear and we obey'. This represents the pinnacle of faith where believers acknowledge their accountability to Allah and seek His forgiveness. The verse establishes the foundation of Islamic monotheism and the requirement to believe in all aspects of the unseen as taught by the prophets.",
        },
      };

      // Verse of the Day data
      const mockVerses = {
        en: {
          reference: "Surah Al-Baqarah 2:255",
          arabic: "اللَّهُ لَا إِلَٰهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ",
          translation:
            "Allah - there is none worthy of worship except Him, the Ever-Living, the Sustainer of existence.",
          tafsir:
            "This verse, known as Ayat al-Kursi, emphasizes Allah's absolute oneness and His eternal nature as the source of all life and sustenance.",
        },
        ur: {
          reference: "سورۃ البقرہ 2:255",
          arabic: "اللَّهُ لَا إِلَٰهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ",
          translation: "اللہ، اس کے سوا کوئی معبود نہیں، وہ زندہ ہے، خود قائم ہے",
          tafsir:
            "یہ آیت، جسے آیت الکرسی کے نام سے جانا جاتا ہے، اللہ کی مطلق اکلوتی اور اس کی ہمیشہ زندہ اور وجود کے بارے میں تعلیم دیتی ہے۔",
        },
        ar: {
          reference: "سورة البقرة 2:255",
          arabic: "اللَّهُ لَا إِلَٰهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ",
          translation: "الله لا إله إلا هو الحي القيوم",
          tafsir:
            "هذه الآية، المعروفة بآية الكرسي، تؤكد على وحدانية الله وطبيعته الأبدية كمصدر للحياة والبقاء.",
        },
        hi: {
          reference: "सूरा अल-बकरा 2:255",
          arabic: "اللَّهُ لَا إِلَٰهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ",
          translation: "अल्लाह, उसके अलावा कोई ईश्वर नहीं, वह जीवित है, स्वयंस्थ है",
          tafsir:
            "यह आयत, जिसे आयतुल कुर्सी के नाम से जाना जाता है, अल्लाह की पूर्ण एकता और उसकी हमेशा जीवित और अस्तित्व के बारे में शिक्षा देती है।",
        },
        "roman-ur": {
          reference: "Surah Al-Baqarah 2:255",
          arabic: "اللَّهُ لَا إِلَٰهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ",
          translation:
            "Allah, us say ilawa koi mabood nahin, woh zinda hai, khud qayam hai",
          tafsir:
            "Ye ayyat, jisay ayyat al-kursi ke naam say jaana jata hai, Allah ki muqaddas oneness aur uski hamesha zinda aur wujood ke bare mein taleem deti hai.",
        },
        "roman-hi": {
          reference: "Surah Al-Baqarah 2:255",
          arabic: "اللَّهُ لَا إِلَٰهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ",
          translation:
            "Allah, uske alawa koi ishwar nahi, woh jivit hai, svayamstha hai",
          tafsir:
            "Ye aayat, jise aayatul kursi ke naam se jaana jaata hai, Allah ki poorn ekta aur uski hamesha jeevit aur astitv ke bare mein shiksha deti hai.",
        },
      };

      const languageOptions = [
        { code: "en", name: "English" },
        { code: "ur", name: "اردو" },
        { code: "ar", name: "العربية" },
        { code: "hi", name: "हिन्दी" },
        { code: "roman-ur", name: "Roman Urdu" },
        { code: "roman-hi", name: "Roman Hindi" },
      ];

      // Mock AI response generator
      const generateAIResponse = (prompt, language) => {
        const lowerPrompt = prompt.toLowerCase();

        // Check for specific verse references
        if (lowerPrompt.includes("2:255") || lowerPrompt.includes("ayat al kursi")) {
          const tafseer = mockTafseerData["2:255"];
          return `${tafseer.tafsir} ${
            language !== "en" ? "\n\n(Translation of tafseer)" : ""
          }`;
        }

        if (lowerPrompt.includes("2:285") || lowerPrompt.includes("iman")) {
          const tafseer = mockTafseerData["2:285"];
          return `${tafseer.tafsir} ${
            language !== "en" ? "\n\n(Translation of tafseer)" : ""
          }`;
        }

        // General Islamic questions
        if (lowerPrompt.includes("prayer") || lowerPrompt.includes("namaz")) {
          return "Prayer (Salah) is one of the five pillars of Islam. It is obligatory for every Muslim to perform five daily prayers at their prescribed times. These prayers are Fajr (dawn), Dhuhr (noon), Asr (afternoon), Maghrib (sunset), and Isha (night). Each prayer consists of specific units (rak'ahs) and includes recitation from the Quran, bowing, and prostration. Prayer is a direct connection between the worshipper and Allah, and it helps maintain spiritual discipline throughout the day.";
        }

        if (lowerPrompt.includes("fasting") || lowerPrompt.includes("roza")) {
          return "Fasting (Sawm) during the month of Ramadan is another pillar of Islam. Muslims abstain from food, drink, and other physical needs from dawn until sunset. Fasting is not just about refraining from eating and drinking; it's also about developing self-control, empathy for the less fortunate, and increasing spirituality. It's obligatory for all healthy adult Muslims, with exceptions for travelers, the sick, pregnant or nursing women, and those who are elderly.";
        }

        if (lowerPrompt.includes("zakat") || lowerPrompt.includes("charity")) {
          return "Zakat is the third pillar of Islam and refers to the obligatory charitable giving. It requires Muslims who meet the necessary criteria to donate a portion (typically 2.5%) of their wealth to those in need. Zakat purifies one's wealth and helps reduce economic inequality in society. It's different from general charity (sadaqah) as it's a fixed obligation with specific rules about who can receive it and what wealth is subject to it.";
        }

        // Default response
        return "As an Islamic AI assistant, I'm here to help answer your questions about Islam based on the Quran and authentic Hadith. Please ask specific questions about Islamic beliefs, practices, history, or rulings, and I'll provide detailed explanations with references to the sources. You can also ask about specific Quranic verses or Hadith for detailed tafseer (explanation) and understanding.";
      };

      // --- The React Component ---
      // We removed "export default"
      function IslamicAIAssistant() {
        const [messages, setMessages] = useState([]);
        const [inputValue, setInputValue] = useState("");
        const [selectedLanguage, setSelectedLanguage] = useState("en");
        const [isLoading, setIsLoading] = useState(false);
        const [attachedImage, setAttachedImage] = useState(null);
        const [verseOfTheDay, setVerseOfTheDay] = useState(mockVerses.en);
        const fileInputRef = useRef(null);
        const messagesEndRef = useRef(null);

        // Scroll to bottom of messages
        useEffect(() => {
          messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
        }, [messages]);

        // Update verse when language changes
        useEffect(() => {
          setVerseOfTheDay(mockVerses[selectedLanguage]);
        }, [selectedLanguage]);

        // **NEW**: Initialize lucide icons whenever messages or language change
        useEffect(() => {
          lucide.createIcons();
        }, [messages, selectedLanguage, verseOfTheDay]);

        const handleSend = () => {
          if ((!inputValue.trim() && !attachedImage) || isLoading) return;

          // Add user message
          const newUserMessage = {
            id: Date.now().toString(),
            role: "user",
            content: inputValue,
            image: attachedImage || undefined,
            timestamp: new Date(),
          };

          setMessages((prev) => [...prev, newUserMessage]);
          setInputValue("");
          setAttachedImage(null);
          setIsLoading(true);

          // Simulate AI response after delay
          setTimeout(() => {
            const responseContent = generateAIResponse(
              inputValue,
              selectedLanguage
            );

            const aiResponse = {
              id: (Date.now() + 1).toString(),
              role: "model",
              content: responseContent,
              sources: ["Quran 2:255", "Tafseer Ibn Kathir", "Sahih Bukhari"],
              timestamp: new Date(),
            };
            setMessages((prev) => [...prev, aiResponse]);
            setIsLoading(false);
          }, 1500);
        };

        const handleImageAttach = (e) => {
          const file = e.target.files?.[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
              setAttachedImage(e.target?.result);
            };
            reader.readAsDataURL(file);
          }
        };

        const removeImage = () => {
          setAttachedImage(null);
          if (fileInputRef.current) {
            fileInputRef.current.value = "";
          }
        };

        const handleKeyDown = (e) => {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            handleSend();
          }
        };

        const copyToClipboard = (text) => {
          navigator.clipboard.writeText(text);
        };

        const speakText = (text) => {
          if ("speechSynthesis" in window) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = selectedLanguage === "ar" ? "ar-SA" : "en-US";
            speechSynthesis.speak(utterance);
          }
        };

        const handleLanguageChange = (lang) => {
          setSelectedLanguage(lang);
        };

        // --- This is the JSX ---
        // We replaced custom components like <Button> with <button>
        // and <Send /> with <i data-lucide="send"></i>
        return (
          <div className="flex flex-col h-screen bg-gradient-to-br from-teal-50 to-cyan-100 dark:from-gray-900 dark:to-gray-800">
            {/* Header */}
            <header className="bg-teal-700 text-white p-4 shadow-md">
              <div className="container mx-auto flex items-center justify-between">
                <div className="flex items-center space-x-3">
                  <div className="bg-white p-2 rounded-full">
                    <i
                      data-lucide="sparkles"
                      className="text-teal-700 h-6 w-6"
                    ></i>
                  </div>
                  <h1 className="text-xl font-bold">Islamic AI Assistant</h1>
                </div>

                <div className="flex items-center space-x-2">
                  <i data-lucide="languages" className="h-5 w-5"></i>
                  <select
                    value={selectedLanguage}
                    onChange={(e) => handleLanguageChange(e.target.value)}
                    className="bg-teal-800 text-white border border-teal-600 rounded-md px-2 py-1 focus:outline-none focus:ring-2 focus:ring-teal-500"
                  >
                    {languageOptions.map((lang) => (
                      <option key={lang.code} value={lang.code}>
                        {lang.name}
                      </option>
                    ))}
                  </select>
                </div>
              </div>
            </header>

            {/* Main Content */}
            <main className="flex-1 overflow-hidden container mx-auto px-4 py-6 flex flex-col">
              {messages.length === 0 ? (
                // Welcome Screen
                <div className="flex-1 flex flex-col items-center justify-center text-center p-4">
                  <div className="bg-teal-100 dark:bg-teal-900/30 p-6 rounded-full mb-6">
                    <i
                      data-lucide="bot"
                      className="h-16 w-16 text-teal-700 dark:text-teal-400"
                    ></i>
                  </div>

                  <h2 className="text-3xl font-bold text-teal-800 dark:text-teal-200 mb-2">
                    As-salamu alaykum!
                  </h2>

                  <p className="text-lg text-gray-700 dark:text-gray-300 max-w-2xl mb-8">
                    Welcome to your Islamic AI Assistant. Ask any questions about
                    Islam, and I'll provide answers based on the Quran and Sunnah
                    with authentic tafseer.
                  </p>

                  <div className="bg-gray-200 border-2 border-dashed rounded-xl w-64 h-48 mb-8 flex items-center justify-center">
                    <i
                      data-lucide="book-open"
                      className="h-12 w-12 text-gray-400"
                    ></i>
                  </div>

                  {/* Verse of the Day: Replaced <Card> and <CardContent> with <div> */}
                  <div className="w-full max-w-2xl bg-white dark:bg-gray-800 shadow-lg rounded-2xl">
                    <div className="p-6">
                      <div className="flex items-center justify-between mb-4">
                        <h3 className="text-xl font-bold text-teal-700 dark:text-teal-400">
                          Verse of the Day
                        </h3>
                        <i
                          data-lucide="book-open"
                          className="h-5 w-5 text-teal-600 dark:text-teal-400"
                        ></i>
                      </div>

                      <div className="text-right mb-4">
                        <p className="text-2xl font-arabic text-gray-800 dark:text-gray-200 mb-2 leading-loose">
                          {verseOfTheDay.arabic}
                        </p>
                        <p className="text-gray-700 dark:text-gray-300 italic">
                          {verseOfTheDay.translation}
                        </p>
                      </div>

                      <div className="border-t border-gray-200 dark:border-gray-700 pt-4">
                        <p className="text-sm text-gray-600 dark:text-gray-400">
                          <span className="font-semibold">
                            {verseOfTheDay.reference}
                          </span>{" "}
                          - {verseOfTheDay.tafsir}
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              ) : (
                // Chat View
                <div className="flex-1 overflow-y-auto mb-4 space-y-6 p-2">
                  {messages.map((message) => (
                    <div
                      key={message.id}
                      className={`flex ${
                        message.role === "user" ? "justify-end" : "justify-start"
                      }`}
                    >
                      <div
                        className={`max-w-[85%] md:max-w-[75%] rounded-2xl p-4 ${
                          message.role === "user"
                            ? "bg-teal-600 text-white rounded-br-none"
                            : "bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 rounded-bl-none shadow-md"
                        }`}
                      >
                        <div className="flex items-start space-x-2">
                          {/* Replaced <Avatar> and <AvatarFallback> with <div> */}
                          <div className="h-8 w-8 rounded-full flex-shrink-0">
                            <div
                              className={`h-full w-full rounded-full flex items-center justify-center ${
                                message.role === "user"
                                  ? "bg-teal-700 text-white"
                                  : "bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"
                              }`}
                            >
                              {message.role === "user" ? (
                                <i data-lucide="user" className="h-4 w-4"></i>
                              ) : (
                                <i data-lucide="bot" className="h-4 w-4"></i>
                              )}
                            </div>
                          </div>

                          <div className="flex-1">
                            {message.image && (
                              <div className="mb-3">
                                <img
                                  src={message.image}
                                  alt="Attached"
                                  className="rounded-lg max-h-48 object-contain"
                                />
                              </div>
                            )}

                            <div
                              className={
                                selectedLanguage === "ar"
                                  ? "text-right font-arabic"
                                  : ""
                              }
                            >
                              {message.content
                                .split("\n")
                                .map((paragraph, i) => (
                                  <p key={i} className="mb-2 last:mb-0">
                                    {paragraph}
                                  </p>
                                ))}
                            </div>

                            {message.role === "model" && message.sources && (
                              <div className="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
                                <p className="text-xs text-gray-600 dark:text-gray-400">
                                  Sources: {message.sources.join(", ")}
                                </p>
                              </div>
                            )}

                            {message.role === "model" && (
                              <div className="flex space-x-2 mt-3">
                                {/* Replaced <Button> with <button> */}
                                <button
                                  type="button"
                                  className="h-8 w-8 p-0 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md"
                                  onClick={() => speakText(message.content)}
                                >
                                  <i
                                    data-lucide="volume-2"
                                    className="h-4 w-4 inline-block"
                                  ></i>
                                </button>
                                <button
                                  type="button"
                                  className="h-8 w-8 p-0 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md"
                                  onClick={() =>
                                    copyToClipboard(message.content)
                                  }
                                >
                                  <i
                                    data-lucide="copy"
                                    className="h-4 w-4 inline-block"
                                  ></i>
                                </button>
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}

                  {isLoading && (
                    <div className="flex justify-start">
                      <div className="max-w-[75%] rounded-2xl rounded-bl-none bg-white dark:bg-gray-800 p-4 shadow-md">
                        <div className="flex items-center space-x-2">
                          <div className="h-8 w-8 rounded-full flex-shrink-0">
                            <div className="h-full w-full rounded-full flex items-center justify-center bg-gray-200 dark:bg-gray-700">
                              <i
                                data-lucide="bot"
                                className="h-4 w-4 text-gray-800 dark:text-gray-200"
                              ></i>
                            </div>
                          </div>
                          <div className="flex space-x-1">
                            <div className="h-2 w-2 rounded-full bg-gray-400 animate-bounce"></div>
                            <div className="h-2 w-2 rounded-full bg-gray-400 animate-bounce delay-75"></div>
                            <div className="h-2 w-2 rounded-full bg-gray-400 animate-bounce delay-150"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  )}
                  <div ref={messagesEndRef} />
                </div>
              )}

              {/* Chat Input */}
              <div className="border-t border-gray-200 dark:border-gray-700 pt-4">
                {attachedImage && (
                  <div className="flex items-center mb-3">
                    <div className="relative">
                      <img
                        src={attachedImage}
                        alt="Preview"
                        className="h-16 w-16 object-cover rounded-md border border-gray-300"
                      />
                      <button
                        onClick={removeImage}
                        className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full h-5 w-5 flex items-center justify-center text-xs"
                      >
                        ×
                      </button>
                    </div>
                  </div>
                )}

                <div className="flex items-end space-x-2">
                  <input
                    type="file"
                    ref={fileInputRef}
                    onChange={handleImageAttach}
                    accept="image/*"
                    className="hidden"
                  />
                  {/* Replaced <Button> with <button> */}
                  <button
                    type="button"
                    className="h-10 w-10 flex-shrink-0 inline-flex items-center justify-center rounded-md border border-input bg-background hover:bg-accent hover:text-accent-foreground"
                    onClick={() => fileInputRef.current?.click()}
                  >
                    <i data-lucide="paperclip" className="h-5 w-5"></i>
                  </button>

                  {/* Replaced <Textarea> with <textarea> */}
                  <textarea
                    value={inputValue}
                    onChange={(e) => setInputValue(e.target.value)}
                    onKeyDown={handleKeyDown}
                    placeholder={`Ask a question about Islam... (in ${
                      languageOptions.find((l) => l.code === selectedLanguage)
                        ?.name
                    })`}
                    className="flex-1 min-h-[40px] max-h-32 resize-none p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-teal-500"
                    rows={1}
                  />

                  {/* Replaced <Button> with <button> */}
                  <button
                    type="button"
                    onClick={handleSend}
                    disabled={
                      isLoading || (!inputValue.trim() && !attachedImage)
                    }
                    className="h-10 w-10 flex-shrink-0 inline-flex items-center justify-center rounded-md bg-teal-600 hover:bg-teal-700 text-white disabled:opacity-50"
                  >
                    <i data-lucide="send" className="h-5 w-5"></i>
                  </button>
                </div>

                <div className="mt-2 text-xs text-gray-600 dark:text-gray-400 text-center">
                  Ask about Quranic verses, Islamic practices, beliefs, or
                  history
                </div>
              </div>
            </main>
          </div>
        );
      }

      // --- 8. Render the App ---
      // This finds the <div id="root"> and mounts our React component inside it.
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<IslamicAIAssistant />);
    </script>
  </body>
</html>
